rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow all users to check if they are admins
    match /admins/{adminUid} {
        allow read: if request.auth.uid == adminUid;
    }

    // Disallows users from editing other's user documents
    match /users/{userId} {
        allow read;
        allow write;
        allow write: if request.auth != null && request.auth.uid == userId;
    }

    match /uploads {
        allow read;
        match /{uploadId} {
            allow read;
            allow write;
            allow write: if request.auth != null && string(request.resource.data.user) == '/databases/' + database + '/documents/users/' + request.auth.uid;
        }
    }

    match /events {
        allow read;
        match /{eventId} {
            allow read;
            allow write;
            match /owners/{ownerUid} {
                allow read: if request.auth.uid == ownerUid;
            }
        }
    }

    match /entries {
        allow read;
        match /{entryId} {
            allow read;
            allow write;
        }
    }

    match /teams {
        allow read;
        match /{teamId} {
            allow read;
            allow write;
        }
    }
  }
}